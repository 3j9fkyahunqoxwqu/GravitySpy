<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>
<html lang="en">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://ldas-jobs.ligo-la.caltech.edu/~scoughlin/O1GravitySpy/css/style.css" />
<script src="https://unpkg.com/masonry-layout@4.1/dist/masonry.pkgd.min.js"></script>
<script src= https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js></script>
<script src=https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js></script> 
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" type="text/css" href="https://ldas-jobs.ligo-la.caltech.edu/~scoughlin/O1GravitySpy/css/classes.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<title>{{ glitchType }}</title>
</head>

<body>
    <h1>{{ header }}</h1>

    <script>
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var xScale = d3.time.scale()
    .domain([315961183000.0 + {{ gpsStart }} *1000, 315961183000.0 + {{ gpsEnd }} * 1000])
    .range([0, width]);

var yScale = d3.scale.log()
    .domain([10, 2048])
    .range([height, 0]);

var yScale2 = d3.scale.log()
    .domain([7, 2000])
    .range([height, 0]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom")
    .tickFormat(d3.time.format("%I:%M"));

formatValue = d3.format(".2s");
var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left")
    .tickFormat(function(d) { return formatValue(d)})

var yAxis2 = d3.svg.axis()
    .scale(yScale2)
    .orient("left")
    .tickFormat(function(d) { return formatValue(d)})

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var svg2 = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the tooltip area to the webpage
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

var tooltip2 = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

d3.json("{{ glitchType }}_metadata.json", function(error, data) {
  if (error) throw error;

  data.forEach(function(d) {
    d.GPStime = new Date(315961183000.0 + d.GPStime * 1000);;
    d.peak_frequency = +d.peak_frequency;
    d.snr = +d.snr
    d.score = +d.score
  });

  xScale.domain(d3.extent(data, function(d) { return d.GPStime; })).nice();
  yScale.domain(d3.extent(data, function(d) { return d.peak_frequency; })).nice();
  yScale2.domain(d3.extent(data, function(d) { return d.snr; })).nice();

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Date");

  svg2.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Date");

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Peak Frequency")

  svg2.append("g")
      .attr("class", "y axis")
      //.attr("transform", "translate(0 ," + height + ")")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("SNR");

  svg.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 3.5)
      .attr("cx", function(d) { return xScale(d.GPStime); })
      .attr("cy", function(d) { return yScale(d.peak_frequency); })
      .style("fill", function(d) { return color(d.Label); })
      .style("opacity", function(d) { return d.score; })
      .on("mouseover", function(d) {
          tooltip.transition()
              .duration(200)
              .style("opacity", .9);
          tooltip.html('ID: ' + d.ID +'<br/>'+ 'GPStime: ' + d.GPStime +'<br/>'+ 'Class: ' + d.Label +'<br/>'+ 'SNR: '+ d.snr +'<br/>'+'peak_freq: '+ d.peak_frequency +' Hz' +'<br/>'+ 'ML confidence: ' + d.score)
              .style("left", (d3.event.pageX + 5) + "px")
              .style("top", margin.top + "px");
          })
      .on('click', function(d) {
          tooltip.style('visibility', 'visible')
              .html('<img src=' + d.linkInd +" width='900px' height='300px' />")
              .style("left", 0 + "px")
              .style("top", margin.top +  "px");
          }) 

  svg2.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 3.5)
      .attr("cx", function(d) { return xScale(d.GPStime); })
      .attr("cy", function(d) { return yScale2(d.snr); })
      .style("fill", function(d) { return color(d.Label); })
      .style("opacity", function(d) { return d.score; })
      .on("mouseover", function(d) {
          tooltip.transition()
              .duration(200)
              .style("opacity", .9);
          tooltip.html('ID: ' + d.ID +'<br/>'+ 'GPStime: ' + d.GPStime +'<br/>'+ 'Class: ' + d.Label +'<br/>'+ 'SNR: '+ d.snr +'<br/>'+'peak_freq: '+ d.peak_frequency +' Hz' +'<br/>'+ 'ML confidence: ' + d.score)
              .style("left", (d3.event.pageX + 20) + "px")
              .style("top", 3 * margin.top + 3* margin.bottom + height +  "px");
          })
      .on('click', function(d) {
          tooltip.style('visibility', 'visible')
              .html('<img src=' + d.linkInd +" width='900px' height='300px' />")
              .style("left", 0 + "px")
              .style("top", 3 * margin.top + 3 * margin.bottom + height +  "px");
          })

  var legend = svg.selectAll(".legend")
      .data(color.domain())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });

});

    </script>

    <p><a href="{{ glitchType }}_metadata.html" > {{ glitchType }} metadata </a></p>
    <p><a href="{{ glitchType }}_metadata.csv" > {{ glitchType }} metadata exports </a></p>

    <div class="grid">
    <div class="grid-sizer"></div>
          {% for path in imagePath %}
            <div class="grid-item"><img src="{{ path }}" title="{{ title[path] }}"/></div>
            {% endfor %}
    </div>
</body>
</html>
